---
title: "Points to discuss"
author: "simeonplatte"
date: "`r Sys.Date()`"
output: 
  workflowr::wflow_html: 
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true
    df_print: paged
    fig_width: 11
    fig_height: 8
    fig_caption: yes
editor_options: 
  chunk_output_type: console
---

```{r libs, include=FALSE}
do_source_data_creation <- FALSE # creates "data_exp" & "data_exp_sum" from scratch from raw data
source("code/eating_disorder_data_proc.R") 
load_inst_pkgs("tidyverse", "magrittr", "psych", "janitor", "knitr", "kableExtra")
```

# Falsch kodierte icd_labels
```{r}
icd_label_dict <- data_exp$diagnosis %>%
  select(icd_code, icd_label) %>%
  filter(!is.na(icd_label)) %>% 
  distinct()

icd_label_dict %>%
  mutate(n_labels = n(), .by = icd_code) %>% 
  filter(n_labels > 1) %>%
  arrange(icd_code) %>% 
  kbl() %>%
  kable_styling(c("striped", "hover", "condensed", "responsive"), full_width = FALSE, position = "left",
                fixed_thead = TRUE) %>%
  column_spec(1, bold = T, border_right = T) %>%
  column_spec(2, width = "30em")
```

# F-Codes ohne Cluster
```{r}
data_exp$diagnosis %>%
  filter(icd_cat_l1 == "F Sonst.") %>%
  use_series(icd_code) %>%
  fct_drop() %>% 
  fct_count(sort = T, prop = T) %>% 
  rename(icd_code = f) %>% 
  left_join(icd_label_dict, multiple = "all")
```

# kein dis_date bei ambulanten Patienten
Kriterien für Abgrenzung von Fällen gegeneinander
```{r}
data_exp$case %>% mutate(has_dis_date = !is.na(dis_date)) %>% tabyl(has_dis_date, case_state)
```

# Regarding cluster "adoleszenten-bezogene Substanzstörungen"
distribution of abuse disorders by substance
```{r}
data_exp$diagnosis %>%
  filter(icd_cat_l1 == "Substanzbezogene Störung") %>%
  use_series(icd_cat_l3) %>% 
  fct_drop() %>% 
  fct_count(sort = T, prop = T) %>%
  rename(icd_cat_l3 = f) %>% 
  mutate(current_cluster = case_when(!!!icd_cats_l2[2]))
```

# Viele Fälle ohne Entlassdiagnose
```{r}
data_exp$diagnosis %>%
  slice_head(n = 1, by = c(case_id, icd_type)) %>% 
  left_join(data_exp$case %>% select(case_id, case_state)) %>%
  tabyl(icd_type, case_state) %>% 
  adorn_totals("col")
data_exp$diagnosis %>% filter(!is.na(icd_code)) %>% use_series(case_id) %>% n_distinct()
```

# concerning readmissions
* when splitting into pre_cov/dur_cov, where to count patients with discharge pre_cov and readmission dur_cov? Options: exclude / assign to pre_cov / **assign to dur_cov**
* results could be skewed since dur_cov has variance restriction - should the pre_cov period be restricted for this stat?

# ED Fälle in Tagesklinik?
* Maybe this is an artifact of merging cases. Should we change case_state merging strategy from first() to max(stationär > teilstationär > ambulant)?
```{r}
df_ed %>% tabyl(case_state, icd_f50)
```



***
Notes
```{r}
# non-F
# Diabetes, Asthma, Adipositas, Epilepsie, Schädel-Hirn-Trauma

# Self-Harm
# X60-84
```
